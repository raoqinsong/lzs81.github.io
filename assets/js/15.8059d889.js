(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{470:function(n,s,e){"use strict";e.r(s);var a=e(2),t=Object(a.a)({},(function(){var n=this,s=n.$createElement,e=n._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("h2",{attrs:{id:"获取下载签名代码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#获取下载签名代码"}},[n._v("#")]),n._v(" 获取下载签名代码")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v(' /**\n     * 获取下载的url\n     * @param objectName\n     * @return\n     */\n    public String downloadUrl(OSSClient ossClient,OssProperties ossProperties,String objectName) {\n\n        Download<Object> download = new Download<>();\n        // 创建OSSClient实例。\n        try {\n            long expireTime = 10;\n            if(StringUtils.isNotBlank(ossProperties.getExpire())){\n                expireTime = Long.parseLong(ossProperties.getExpire());\n            }\n\n            long expireEndTime = System.currentTimeMillis() + expireTime * 1000;\n            Date expiration = new Date(expireEndTime);\n            URL downloadUrl = ossClient.generatePresignedUrl(ossProperties.getBucketName(),objectName,expiration);\n\n            /// download.setDownloadUrl(downloadUrl.toString());\n            return downloadUrl.toString();\n        }catch (Exception e){\n            log.error("获取下载url失败:",e);\n        }\n        return "";\n    }\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br")])]),e("h2",{attrs:{id:"使用说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用说明"}},[n._v("#")]),n._v(" 使用说明")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('@SpringBootApplication\n@EnableAliyunOss\n@EnableSwagger2Doc\n@RestController\npublic class Application {\n    public static void main(String[] args) {\n        SpringApplication.run(Application.class, args);\n    }\n    @ApiOperation("获取下载的url")\n    @PostMapping("/getUrl")\n    public String downloadUrl(@RequestParam("objectName") String objectName,@RequestParam("fileName")String fileName) {\n        UploadFileDO uploadFile = new UploadFileDO();\n        uploadFile.setNewObjectName(objectName);\n        uploadFile.setOldObjectName(fileName);\n        uploadFile.setGmtModified(new Date());\n        uploadFile.setGmtCreate(new Date());\n        UploadFileDO uploadFileDO = remoteUploadFileService.getObjectName(uploadFile);\n        if (uploadFileDO == null){\n            throw new CusException("该文件不存在");\n        }\n        String url = new OssClientManager().downloadUrl(ossClient, ossProperties, objectName);\n\n        if (StringUtils.isBlank(url)){\n            throw new CusException("获取下载url失败");\n        }\n        return  url;\n    }\n}\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br")])]),e("p",[e("a",{attrs:{href:"https://gitee.com/raoqinsong/oss-starter",target:"_blank",rel:"noopener noreferrer"}},[n._v("码云"),e("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=t.exports}}]);